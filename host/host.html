<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Host App - External Search Iframe Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
    }
    iframe {
      width: 100%;
      height: 300px;
      border: 2px solid #ccc;
      border-radius: 8px;
    }
    #log {
      margin-top: 1rem;
      padding: 0.5rem;
      background: #f7f7f7;
      border-radius: 6px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h2>Host App</h2>
  <p>This page embeds an external search widget inside an iframe.</p>

  <iframe id="widget-frame" src="http://localhost:8001/widget.html"></iframe>

  <h3>Event Log (Messages from Widget)</h3>
  <pre id="log">Waiting for messages...</pre>

  <script>
    const logEl = document.getElementById('log');
    const frame = document.getElementById('widget-frame');

    // Listen for messages from the iframe
    window.addEventListener('message', (event) => {
      // Only accept from our known widget origin
      if (event.origin !== 'http://localhost:8001') return;
      const data = event.data;
      if (!data || typeof data !== 'object') return;

      logEl.textContent += `\n${new Date().toLocaleTimeString()} - ${JSON.stringify(data)}`;
      console.log('Message from widget:', data);
    });

    // Example init message (could be automated test trigger)
    window.addEventListener('load', () => {
      frame.contentWindow.postMessage({ type: 'init', payload: { theme: 'light' } }, 'http://localhost:8001');
    });
  </script>
</body>
</html>
